<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Font to SVG with Fabric.js</title>
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/opentype.js/1.3.4/opentype.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

    <style>
        body { font-family: sans-serif; margin: 0; padding: 20px; text-align: center; background: #222; color: #eee; }
        .toolbar { padding: 10px; background: #333; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .toolbar input, .toolbar select, .toolbar button { padding: 5px; }
        .canvas-container { display: flex; justify-content: center; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>Font to SVG Editor (Fabric.js)</h1>

    <!-- Toolbar -->
    <div class="toolbar">
        <label>Letter: <input id="letterInput" type="text" maxlength="1" placeholder="Enter letter"></label>
        <label>Font: <select id="fontSelect"></select></label>
        <label>Upload Font: <input id="fontUpload" type="file" accept=".ttf,.otf"></label>
        <button onclick="generateLetterTemplate()">Generate</button>
    </div>

    <!-- Canvas Area -->
    <div class="canvas-container">
        <canvas id="fabricCanvas" width="600" height="600"></canvas>
    </div>

    <script>
        /***************************
         * 🌟 Initialize Fabric.js Canvas
         ***************************/
        const fabricCanvas = new fabric.Canvas("fabricCanvas", {
            backgroundColor: "white"
        });

        let loadedFonts = {};
        const strokeColors = ["red", "green", "blue", "orange", "purple", "cyan", "pink", "yellow"];

        /***************************
         * 🖋️ Convert Font to SVG Paths (Use Fabric.js)
         ***************************/
        function generateLetterTemplate() {
            const letter = document.getElementById("letterInput").value.trim();
            if (!letter) {
                alert("Please enter a letter.");
                return;
            }

            const fontName = document.getElementById("fontSelect").value;
            if (!loadedFonts[fontName]) {
                alert("Font not loaded yet. Please try again.");
                return;
            }

            const font = loadedFonts[fontName];
            const glyph = font.charToGlyph(letter);
            const pathData = glyph.getPath(50, 250, 200).toPathData();

            // Convert SVG path string into Fabric.js paths
            loadSVGIntoFabric(pathData);
        }

        /***************************
         * 📂 Convert SVG Path Data into Fabric.js Paths
         ***************************/
        function loadSVGIntoFabric(svgPathData) {
            fabricCanvas.clear(); // Clear previous letters

            // Split path data into separate strokes (each "M" command starts a new stroke)
            const paths = svgPathData.split(/(?=M)/).filter(seg => seg.trim().length > 0);

            paths.forEach((path, index) => {
                const color = strokeColors[index % strokeColors.length]; // Assign different colors

                fabric.loadSVGFromString(`<svg xmlns="http://www.w3.org/2000/svg"><path d="${path.trim()}" /></svg>`, function(objects) {
                    objects.forEach(obj => {
                        obj.set({
                            fill: color,
                            stroke: color, // Assign unique color
                            strokeWidth: 2,
                            selectable: true,
                            evented: true,
                            hasControls: true,
                            hoverCursor: "pointer"
                        });

                        fabricCanvas.add(obj);
                    });

                    fabricCanvas.renderAll(); // Update canvas
                });
            });
        }

        /***************************
         * 📁 Load Default Fonts Dynamically
         ***************************/
        function loadDefaultFonts() {
            const fontSelect = document.getElementById("fontSelect");
            const defaultFonts = [
                { name: "Roboto", url: "./Roboto[wdth,wght].ttf" },
                { name: "Lohit-Devanagari", url: "./Lohit-Devanagari.ttf" },
                { name: "Amiri-Regular", url: "./Amiri-Regular.ttf" }
            ];

            defaultFonts.forEach(font => {
                const opt = document.createElement("option");
                opt.value = font.name;
                opt.textContent = font.name;
                fontSelect.appendChild(opt);

                opentype.load(font.url, function(err, loadedFont) {
                    if (!err) loadedFonts[font.name] = loadedFont;
                });
            });
        }

        /***************************
         * 📂 Handle Font Uploads
         ***************************/
        document.getElementById("fontUpload").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const font = opentype.parse(e.target.result);
                    const name = file.name.replace(/\.[^/.]+$/, "");
                    loadedFonts[name] = font;

                    const fontSelect = document.getElementById("fontSelect");
                    let opt = document.createElement("option");
                    opt.value = name;
                    opt.textContent = name;
                    fontSelect.appendChild(opt);
                    fontSelect.value = name;

                    alert("Loaded font: " + name);
                } catch (err) {
                    alert("Error parsing font file.");
                }
            };
            reader.readAsArrayBuffer(file);
        });

        window.addEventListener("DOMContentLoaded", loadDefaultFonts);
    </script>
</body>
</html>
